<main class="page">
  <section class="header">
    <h1>Depenses</h1>
    <p>Creer, modifier et supprimer vos depenses en local.</p>
  </section>

  <section class="card">
    <h2>Nouvelle depense</h2>
    <form (ngSubmit)="createExpense()" class="form">
      <label>
        Montant
        <input type="number" step="0.01" min="0" [(ngModel)]="newExpense.amount" name="amount" />
      </label>
      <label>
        Lieu
        <input type="text" [(ngModel)]="newExpense.place" name="place" />
      </label>
      <label>
        Date
        <input type="date" [(ngModel)]="newExpense.expense_date" name="expense_date" />
      </label>
      <label>
        Categorie
        <select [(ngModel)]="newExpense.category" name="category">
          <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
        </select>
      </label>
      <button type="submit">Ajouter</button>
    </form>
    <p class="error" *ngIf="errorMessage">{{ errorMessage }}</p>
  </section>

  <section class="card">
    <div class="toolbar">
      <h2>Liste des depenses</h2>
      <button type="button" (click)="loadExpenses()">Recharger</button>
    </div>

    <p *ngIf="loading">Chargement...</p>

    <table *ngIf="!loading">
      <thead>
        <tr>
          <th>Montant</th>
          <th>Lieu</th>
          <th>Date</th>
          <th>Categorie</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let expense of expenses">
          <td *ngIf="editingId !== expense.id">{{ expense.amount | number: '1.2-2' }}</td>
          <td *ngIf="editingId === expense.id && editModel as model">
            <input type="number" step="0.01" min="0" [(ngModel)]="model.amount" name="editAmount{{ expense.id }}" />
          </td>

          <td *ngIf="editingId !== expense.id">{{ expense.place }}</td>
          <td *ngIf="editingId === expense.id && editModel as model">
            <input type="text" [(ngModel)]="model.place" name="editPlace{{ expense.id }}" />
          </td>

          <td *ngIf="editingId !== expense.id">{{ expense.expense_date }}</td>
          <td *ngIf="editingId === expense.id && editModel as model">
            <input type="date" [(ngModel)]="model.expense_date" name="editDate{{ expense.id }}" />
          </td>

          <td *ngIf="editingId !== expense.id">{{ expense.category }}</td>
          <td *ngIf="editingId === expense.id && editModel as model">
            <select [(ngModel)]="model.category" name="editCategory{{ expense.id }}">
              <option *ngFor="let category of categories" [value]="category">{{ category }}</option>
            </select>
          </td>

          <td class="actions">
            <button *ngIf="editingId !== expense.id" type="button" (click)="startEdit(expense)">Modifier</button>
            <button *ngIf="editingId === expense.id" type="button" (click)="saveEdit()">Sauver</button>
            <button *ngIf="editingId === expense.id" type="button" (click)="cancelEdit()">Annuler</button>
            <button type="button" (click)="deleteExpense(expense)">Supprimer</button>
          </td>
        </tr>
      </tbody>
    </table>
  </section>
</main>

